---
title: "Moscas Manova"
author: "Matheus"
date: "6 de novembro de 2017"
output: pdf_document
---

#Moscas

##Pacotes
```{r}
source("funcoes.R")
pacotes <- c("ggplot2",
             "magrittr",
             "gridExtra",
             "xtable",
             "dplyr",
             "purrr",
             "tidyr")

ipak(pacotes)
options(xtable.comment = FALSE)
```
##Lendo Os Dados

```{r}

dados <- read.table("Dados/Moscas.txt")

nomes_COl <- c("Especie" = "Especie",
              "CompAsa" =  "Comprimento da asa",
              "LargAsa" = "Largura da asa",
              "Comp3Palpo" = "Comprimento do terceiro palpo",
              "Larg3Palpo" =  "Largura do terceiro palpo", 
              "Comp4Palpo" = "Comprimento do quarto palpo",
              "Comp12Antena" = 
           "Comprimento do 12ºsegmento\n da antena",
            "Comp13Antena" =  "Comprimento do 13ºsegmento\n da antena")



colnames(dados) <- c("Especie","CompAsa","LargAsa","Comp3Palpo",          "Larg3Palpo","Comp4Palpo","Comp12Antena","Comp13Antena")

Especie_chr <- function(x){
  if (x == 0)
    y <- "torrens"
  else
    y <- "carteri"
}
dados %<>% mutate( Especie_fct = 
                    factor(map_chr(Especie,Especie_chr)))


```


#Analise Descritiva

##Medidas Descritivas

```{r results = "asis"}
descritivas <- 
dados %>% select_if(.predicate = is.integer) %>% 
  gather(Coluna,valores,-Especie) %>% 
  group_by(Coluna,Especie) %>% 
  summarise_if(.predicate = function(x) is.numeric(x),
                  .funs = c(Media = "mean",
                     DP = "sd",
                     Var. = "var",
                     Minimo = "min",
                     CV =  "cv",
                     Mediana = "median",
                     Maximo = "max")) %>% 
  mutate_if(.predicate = is.numeric,funs(round(.,3))) %>% 
  mutate(Especie =  factor(map_chr(Especie,Especie_chr)))


descritivas_2 <- nest(descritivas)

for(i in 1:7){
  print(xtable(descritivas_2$data[[i]], 
         caption = nomes_COl[descritivas_2$Coluna[i]] ))
}

```



\newpage

##Boxplots
```{r}
##criando funcao para facilitar a criação dos boxplots
boxplots_moscas <- function(coluna){
 qplot(dados$Especie_fct,coluna,geom = "boxplot") + labs(x = "Espécie") + theme_bw()
}

graficos <- apply(dados[,2:8],2,boxplots_moscas)

for(i in 1:7)
 graficos[[i]] <-  graficos[[i]] + labs(y = nomes_COl[i + 1])
  
##print os boxplots
grid.arrange(graficos[[1]], graficos[[2]], 
             graficos[[3]], graficos[[4]])

grid.arrange(graficos[[5]], graficos[[6]], 
             graficos[[7]], 
            layout_matrix = rbind(c(1,1),c(2,3)))


```

##Histograma
```{r}
##criando funcao para facilitar a criação dos boxplots
hist_moscas <- function(coluna){
 qplot(coluna,geom = "histogram",col = I("black"),fill = I("white"),
       binwidth = 1) + theme_bw() 
}

graficos <- apply(dados[,2:8],2,hist_moscas)

for(i in 1:7)
 graficos[[i]] <-  graficos[[i]] + labs(x = nomes_COl[i+1],y = NULL)
  
##print os boxplots
grid.arrange(graficos[[1]], graficos[[2]], 
             graficos[[3]], graficos[[4]])

grid.arrange(graficos[[5]], graficos[[6]], 
             graficos[[7]], 
            layout_matrix = rbind(c(1,1),c(2,3)))
```

##Diagrama Dispersao


```{r}
cols <- character(nrow(dados))
cols[] <- "black"

cols[dados$Especie_fct == "carteri"] <- "red"
cols[dados$Especie_fct == "torrens"] <- "blue"
pairs(dados[,2:8],col=cols,upper.panel = NULL)
par(xpd = T)
legend("topright", legend = c(levels(dados$Especie_fct)), 
       fill = c("blue","red"))

```



##Distancia de Mahalanobis


```{r}
mx <- dados[,2:8] %>% as.matrix()
nvar <- 7
n <- 70
vmu <- apply(dados[dados$Especie==0,2:8],2,mean)
s2 <- cov(dados[dados$Especie == 0,2:8])
n0 <- nrow(dados[dados$Especie == 0,2:8])
mmu <- t(matrix(t(vmu),nvar,n0))
# Envelopes para a forma quadratica
#
par(mfrow = c(1,2))
vQ <- n*apply(((mx-vmu)*(mx-vmu)%*%solve(s2)),1,sum)

qqPlot(vQ,dist="chisq",df=nvar,col.lines=1,grid="FALSE",xlab="quantil da distribuição qui-quadrado",ylab="quantil da forma quadratica",cex=1.2,id.cex=1.2,main="Torrens")

##

vmu <- apply(dados[dados$Especie== 1,2:8],2,mean)
s2 <- cov(dados[dados$Especie == 1,2:8])
n0 <- nrow(dados[dados$Especie == 1,2:8])
mmu <- t(matrix(t(vmu),nvar,n0))
# Envelopes para a forma quadratica
#

vQ <- n*apply(((mx-vmu)*(mx-vmu)%*%solve(s2)),1,sum)

qqPlot(vQ,dist="chisq",df=nvar,col.lines=1,grid="FALSE",xlab="quantil da distribuição qui-quadrado",ylab="quantil da forma quadratica",cex=1.2,id.cex=1.2,main = "Carteri")

```



